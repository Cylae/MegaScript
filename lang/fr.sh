#!/bin/bash
# French Language File

# --- Global ---
MSG_PRESS_ANY_KEY="Appuyez sur une touche pour continuer..."
MSG_ERROR_INVALID_OPTION="Option invalide. Veuillez réessayer."
MSG_INFO_OPERATION_CANCELLED="Opération annulée."

# --- Language Selection ---
PROMPT_CHOOSE_LANGUAGE="Veuillez choisir une langue : [1] English, [2] Français"

# --- Main Menu ---
MENU_MAIN_TITLE="Menu de Configuration & Gestion du Serveur"
MENU_MAIN_HEADER="============================================="
MENU_SECTION_INITIAL="--- Installation Initiale ---"
MENU_OPTION_1="1. Configuration Initiale du Serveur (MàJ, Pare-feu, LEMP)"
MENU_OPTION_2="2. Ajouter un Nouveau Site Web (avec SSL)"
MENU_OPTION_3="3. Configurer le Serveur Mail (Postfix & Dovecot)"
MENU_OPTION_4="4. Créer un Utilisateur SFTP"
MENU_OPTION_5="5. Renforcer la Sécurité (Installer Fail2ban)"
MENU_SECTION_UTILS="--- Utilitaires ---"
MENU_OPTION_6="6. Sauvegarder un Site Web"
MENU_OPTION_7="7. Restaurer un Site Web"
MENU_SECTION_MGMT="--- Gestion ---"
MENU_OPTION_8="8. Gérer les Services Existants"
MENU_OPTION_9="9. Quitter"
PROMPT_CHOOSE_OPTION="Entrez votre choix"
MSG_EXITING="Fermeture du script. Au revoir !"

# --- Initial Checks ---
MSG_INFO_RUNNING_CHECKS="Vérifications initiales du système en cours..."
MSG_ERROR_MUST_BE_ROOT="Ce script doit être exécuté en tant que root ou avec sudo."
MSG_SUCCESS_ROOT_CONFIRMED="Privilèges root confirmés."

# --- OS Detection ---
MSG_INFO_DETECTING_OS="Détection du système d'exploitation..."
MSG_ERROR_CANNOT_DETECT_OS="Impossible de détecter le système d'exploitation depuis /etc/os-release."
MSG_SUCCESS_DEBIAN_BASED="Système basé sur Debian/Ubuntu détecté."
MSG_ERROR_NO_PKG_MANAGER="Gestionnaire de paquets 'dnf' ou 'yum' introuvable sur ce système."
MSG_SUCCESS_RHEL_BASED="Système basé sur RHEL/CentOS/Fedora détecté."
MSG_ERROR_UNSUPPORTED_OS="Système d'exploitation non supporté : %s. Ce script supporte Debian, Ubuntu, CentOS, RHEL et Fedora."

# --- Initial Setup ---
MSG_WARN_INITIAL_SETUP="Ceci installera et configurera la pile LEMP (Nginx, MariaDB, PHP) et le pare-feu."
PROMPT_ARE_YOU_SURE="Êtes-vous sûr de vouloir continuer ? [o/N] :"
MSG_INFO_STARTING_SETUP="Démarrage de la configuration initiale du serveur..."
MSG_SUCCESS_SETUP_COMPLETE="Configuration initiale du serveur terminée avec succès."

# --- Firewall ---
MSG_INFO_CONFIG_FIREWALL="Configuration du pare-feu (UFW)..."
MSG_WARN_UFW_NOT_FOUND="Commande UFW introuvable. Configuration du pare-feu ignorée. Veuillez l'installer et le configurer manuellement."
MSG_SUCCESS_FIREWALL_CONFIGURED="Le pare-feu est configuré et activé."

# --- LEMP Stack ---
MSG_INFO_INSTALLING_LEMP="Installation de la pile LEMP (Nginx, MariaDB, PHP)..."
MSG_INFO_UPDATING_PACKAGES="Mise à jour des listes de paquets..."
MSG_ERROR_PHP_FPM_NOT_FOUND="Impossible de détecter un paquet PHP-FPM approprié. Utilisation de 'php-fpm' par défaut."
MSG_INFO_PHP_VERSION_DETECTED="Dernière version de PHP détectée : %s"
MSG_INFO_ENABLE_SERVICES="Activation et démarrage des services..."
MSG_WARN_PHP_FPM_SERVICE_UNKNOWN="Impossible de déterminer le nom du service PHP-FPM pour l'activer."
MSG_SUCCESS_LEMP_INSTALLED="Pile LEMP installée."

# --- MariaDB ---
MSG_INFO_SECURING_MARIADB="Sécurisation de l'installation de MariaDB..."
MSG_SUCCESS_MARIADB_SECURED="L'installation de MariaDB a été sécurisée."
MSG_WARN_MARIADB_ROOT_PASSWORD_SET="Un nouveau mot de passe aléatoire a été défini pour l'utilisateur 'root' de MariaDB."
MSG_WARN_MARIADB_ROOT_PASSWORD_IS="Mot de passe root (enregistrez-le !) : %s"
MSG_INFO_MARIADB_PASSWORD_SAVED="Mot de passe root enregistré dans /root/.mysql_root_password pour l'automatisation du script."

# --- Add Website ---
MENU_ADD_WEBSITE="--- Ajouter un Nouveau Site Web ---"
PROMPT_ENTER_DOMAIN="Entrez le nom de domaine (ex: example.com) :"
MSG_ERROR_DOMAIN_EMPTY="Le nom de domaine ne peut pas être vide."
MSG_INFO_CREATING_WEB_ROOT="Création de la racine web à %s..."
MSG_SUCCESS_WEB_ROOT_CREATED="Racine web créée."
MSG_INFO_CONFIGURING_NGINX="Configuration du bloc serveur Nginx..."
MSG_SUCCESS_NGINX_CONF_CREATED="Fichier de configuration Nginx créé à %s."
MSG_INFO_TESTING_NGINX="Test et rechargement de Nginx..."
MSG_SUCCESS_NGINX_RELOADED="Configuration Nginx rechargée."
MSG_ERROR_NGINX_TEST_FAILED="Le test de configuration Nginx a échoué. Veuillez vérifier %s"

# --- SSL ---
MSG_INFO_SETTING_UP_SSL="Configuration de SSL pour %s avec Certbot..."
MSG_INFO_CERTBOT_NOT_FOUND="Certbot introuvable. Installation en cours..."
MSG_SUCCESS_CERTBOT_INSTALLED="Certbot installé."
MSG_INFO_REQUESTING_CERT="Demande de certificat SSL pour %s et www.%s..."
PROMPT_ENTER_EMAIL="Entrez votre adresse e-mail (pour les notifications de certificat SSL) :"
MSG_ERROR_EMAIL_REQUIRED="Une adresse e-mail est requise pour Certbot."
MSG_SUCCESS_SSL_OBTAINED="Certificat SSL obtenu et configuré avec succès pour %s."
MSG_ERROR_SSL_FAILED="Échec de l'obtention du certificat SSL pour %s."
MSG_WARN_SITE_HTTP_ONLY="Votre site n'est actuellement disponible que via HTTP."

# --- Mail Server ---
MENU_SETUP_MAIL_SERVER="--- Configurer le Serveur Mail (Postfix & Dovecot) ---"
MSG_WARN_MAIL_ADVANCED_SETUP="Ceci est une configuration avancée. Vous DEVEZ posséder un nom de domaine enregistré et avoir configuré l'enregistrement DNS MX pour pointer vers le nom d'hôte de ce serveur."
PROMPT_ENTER_MAIL_DOMAIN="Entrez votre domaine de messagerie principal (ex: example.com) :"
MSG_ERROR_MAIL_DOMAIN_EMPTY="Le domaine de messagerie ne peut pas être vide."
PROMPT_ENTER_MAIL_HOSTNAME="Entrez le nom d'hôte du serveur de messagerie (ex: mail.example.com) :"
MSG_ERROR_MAIL_HOSTNAME_EMPTY="Le nom d'hôte de messagerie ne peut pas être vide."
MSG_INFO_INSTALLING_MAIL_SERVER="Installation de Postfix, Dovecot et Augeas..."
MSG_SUCCESS_MAIL_SERVER_INSTALLED="Postfix et Dovecot installés."
MSG_INFO_CONFIGURING_POSTFIX_MAIN="Configuration de Postfix main.cf..."
MSG_INFO_CONFIGURING_POSTFIX_MASTER="Configuration de Postfix master.cf pour la soumission..."
MSG_INFO_FOUND_CERT="Certificat Let's Encrypt trouvé pour %s."
MSG_WARN_NO_CERT_FOUND="Aucun certificat SSL trouvé pour %s. Postfix utilisera TLS opportuniste sans certificat."
MSG_WARN_CREATE_WEBSITE_FOR_CERT="Il est fortement recommandé de créer un site web pour %s afin d'obtenir un certificat."
MSG_SUCCESS_POSTFIX_CONFIGURED="Postfix configuré."
MSG_INFO_CONFIGURING_DOVECOT="Configuration de Dovecot avec augtool..."
MSG_WARN_DOVECOT_SELF_SIGNED="Aucun certificat SSL trouvé pour %s. Dovecot utilisera des certificats auto-signés."
MSG_SUCCESS_DOVECOT_CONFIGURED="Dovecot configuré."
MSG_INFO_OPENING_MAIL_PORTS="Ouverture des ports de messagerie dans le pare-feu..."
MSG_SUCCESS_MAIL_PORTS_OPENED="Ports de messagerie ouverts."
MSG_INFO_RESTARTING_MAIL_SERVICES="Redémarrage des services de messagerie..."
MSG_SUCCESS_MAIL_SERVER_COMPLETE="La configuration du serveur de messagerie est terminée."
MSG_INFO_ADD_MAIL_USERS_HOW_TO="Vous pouvez maintenant ajouter des comptes de messagerie en créant des utilisateurs Linux standards (ex: 'useradd -m nomdutilisateur')."
MSG_INFO_INSTALLING_AUGEAS="Augeas introuvable. Installation de augeas-tools..."
MSG_SUCCESS_AUGEAS_INSTALLED="Augeas installé."
MSG_ERROR_CANNOT_INSTALL_AUGEAS="Gestionnaire de paquets non défini. Impossible d'installer Augeas."

# --- SFTP User ---
MENU_CREATE_SFTP_USER="--- Créer un Nouvel Utilisateur SFTP ---"
PROMPT_ENTER_SFTP_USER="Entrez le nouveau nom d'utilisateur SFTP :"
MSG_ERROR_SFTP_USER_EMPTY="Le nom d'utilisateur SFTP ne peut pas être vide."
PROMPT_ENTER_SFTP_PASSWORD="Entrez le mot de passe pour %s :"
MSG_ERROR_PASSWORD_EMPTY="Le mot de passe ne peut pas être vide."
PROMPT_ENTER_SFTP_DIR="Entrez le chemin complet du répertoire auquel accorder l'accès (ex: /var/www/example.com) :"
MSG_ERROR_DIR_NOT_EXIST="Le répertoire '%s' n'existe pas."
MSG_ERROR_SFTP_JAIL_OWNER="Exigence de la prison SFTP non respectée : Le répertoire '%s' doit appartenir à 'root'."
MSG_WARN_SFTP_JAIL_PRACTICE="Une pratique courante consiste à avoir une prison appartenant à root (ex: /var/www/domaine) et un sous-répertoire accessible en écriture à l'intérieur (ex: /var/www/domaine/public_html) appartenant à l'utilisateur sftp."
MSG_INFO_CREATING_SFTP_USER="Création de l'utilisateur '%s' et configuration de la prison SFTP..."
MSG_INFO_USER_EXISTS="L'utilisateur '%s' existe peut-être déjà. Poursuite de la configuration."
MSG_SUCCESS_USER_CREATED="Utilisateur '%s' créé/mot de passe mis à jour."
MSG_INFO_CONFIGURING_SSHD="Configuration du serveur SSH pour la prison SFTP..."
MSG_SUCCESS_SFTP_JAIL_CONFIGURED="Prison SFTP configurée pour '%s' dans %s."
MSG_ERROR_SSHD_CONFIG_FAILED="Échec de la configuration de sshd_config avec augtool."
MSG_INFO_CREATING_WRITABLE_DIR="Création du répertoire accessible en écriture à %s..."
MSG_SUCCESS_WRITABLE_DIR_CREATED="Répertoire accessible en écriture créé."
MSG_INFO_RESTARTING_SSH="Redémarrage du service SSH..."
MSG_SUCCESS_SSH_RESTARTED="Service SSH redémarré."
MSG_SUCCESS_SFTP_USER_READY="L'utilisateur SFTP '%s' est prêt. L'utilisateur est emprisonné dans '%s' et a un accès en écriture à '%s'."

# --- Fail2ban ---
MENU_FAIL2BAN="--- Renforcer la Sécurité (Fail2ban) ---"
PROMPT_INSTALL_FAIL2BAN="Installer et configurer Fail2ban pour se protéger contre les attaques par force brute ? [o/N] :"
MSG_INFO_INSTALLING_FAIL2BAN="Installation de Fail2ban..."
MSG_ERROR_FAIL2BAN_INSTALL_FAILED="Échec de l'installation de Fail2ban."
MSG_SUCCESS_FAIL2BAN_INSTALLED="Fail2ban installé."
MSG_INFO_CONFIGURING_FAIL2BAN="Configuration des prisons Fail2ban pour SSH, Postfix et Dovecot..."
MSG_INFO_STARTING_FAIL2BAN="Activation et démarrage du service Fail2ban..."
MSG_SUCCESS_FAIL2BAN_ACTIVE="Fail2ban est maintenant actif et protège votre serveur."

# --- Backup ---
MENU_BACKUP_WEBSITE="--- Sauvegarder un Site Web ---"
PROMPT_ENTER_DOMAIN_TO_BACKUP="Entrez le domaine du site à sauvegarder (ex: example.com) :"
MSG_ERROR_WEB_ROOT_NOT_EXIST="La racine web '%s' n'existe pas."
PROMPT_ENTER_DB_TO_BACKUP="Entrez le nom de la base de données à sauvegarder :"
MSG_ERROR_DB_NAME_EMPTY="Le nom de la base de données ne peut pas être vide."
MSG_INFO_STARTING_BACKUP="Démarrage de la sauvegarde pour '%s'..."
MSG_INFO_DUMPING_DB="Exportation de la base de données '%s'..."
MSG_ERROR_DB_PASS_NOT_FOUND="Fichier de mot de passe root de MariaDB introuvable. Impossible d'automatiser la sauvegarde."
MSG_ERROR_DB_DUMP_FAILED="L'exportation de la base de données a échoué. Vérifiez si la base de données '%s' existe."
MSG_SUCCESS_DB_DUMPED="Base de données exportée avec succès."
MSG_INFO_ARCHIVING_FILES="Archivage du contenu de la racine web depuis '%s'..."
MSG_INFO_CREATING_BACKUP_FILE="Création du fichier de sauvegarde final à '%s'..."
MSG_SUCCESS_BACKUP_COMPLETE="Sauvegarde terminée ! Fichier enregistré à : %s"

# --- Restore ---
MENU_RESTORE_WEBSITE="--- Restaurer un Site Web à partir d'une Sauvegarde ---"
MSG_WARN_RESTORE_DESTRUCTIVE="Ceci est une opération DESTRUCTIVE. Elle écrasera les fichiers du site web et le contenu de la base de données."
PROMPT_ENTER_BACKUP_PATH="Entrez le chemin complet du fichier de sauvegarde à restaurer :"
MSG_ERROR_BACKUP_FILE_NOT_FOUND="Fichier de sauvegarde introuvable à '%s'."
PROMPT_ENTER_DOMAIN_TO_RESTORE="Entrez le nom de domaine que vous restaurez (ex: example.com) :"
PROMPT_ENTER_DB_TO_RESTORE="Entrez le nom de la base de données dans laquelle restaurer :"
MSG_WARN_CONFIRM_RESTORE="Ceci écrasera tous les fichiers dans '%s' et toutes les tables de la base de données '%s'."
PROMPT_CONFIRM_RESTORE="Pour confirmer, veuillez taper le nom de domaine '%s' :"
MSG_ERROR_CONFIRMATION_FAILED="Confirmation échouée. Opération de restauration annulée."
MSG_INFO_EXTRACTING_BACKUP="Extraction du fichier de sauvegarde..."
MSG_INFO_RESTORING_FILES="Restauration des fichiers vers '%s'..."
MSG_INFO_MOVED_EXISTING_ROOT="La racine web existante a été déplacée vers '%s.bak-...'. "
MSG_SUCCESS_FILES_RESTORED="Fichiers restaurés."
MSG_WARN_NO_WEB_ROOT_IN_BACKUP="Aucun répertoire 'web_root_content' trouvé dans l'archive de sauvegarde. Restauration des fichiers ignorée."
MSG_INFO_RESTORE_VERSION_NOTE="Note : Ce script pourrait ne pas être capable de restaurer des sauvegardes faites avec d'anciennes versions."
MSG_INFO_RESTORING_DB="Restauration de la base de données '%s' à partir de '%s'..."
MSG_ERROR_DB_RESTORE_PASS_NOT_FOUND="Fichier de mot de passe root de MariaDB introuvable. Impossible d'automatiser la restauration."
MSG_ERROR_DB_RESTORE_FAILED="La restauration de la base de données a échoué."
MSG_SUCCESS_DB_RESTORED="Base de données restaurée."
MSG_WARN_NO_SQL_IN_BACKUP="Aucun fichier .sql trouvé dans l'archive de sauvegarde. Restauration de la base de données ignorée."
MSG_SUCCESS_RESTORE_COMPLETE="Restauration terminée pour '%s'."

# --- Website Management ---
MENU_WEBSITE_MGMT="--- Gestion des Sites Web ---"
MSG_NO_WEBSITES_FOUND="Aucune configuration de site web trouvée."
PROMPT_WEBSITE_DELETE="Entrez le nom de configuration complet du site à supprimer (ex: example.com.conf):"
PROMPT_WEBSITE_DISABLE="Entrez le nom de configuration du site à désactiver:"
PROMPT_WEBSITE_ENABLE="Entrez le nom de configuration du site à activer:"
MSG_INVALID_SELECTION="Sélection invalide ou fichier de configuration introuvable."
MSG_WARN_PERMANENT_DELETE="Ceci supprimera définitivement la configuration Nginx, les fichiers web dans /var/www/%s, le certificat SSL et optionnellement la base de données."
PROMPT_CONFIRM_DELETE_WEBSITE="Pour confirmer, veuillez taper le nom de domaine '%s':"
MSG_NGINX_CONF_REMOVED="Configuration Nginx supprimée."
MSG_WEB_ROOT_REMOVED="Répertoire racine web /var/www/%s supprimé."
MSG_SSL_CERT_DELETED="Tentative de suppression du certificat SSL pour %s."
PROMPT_DELETE_DB="Voulez-vous supprimer la base de données associée ? [o/N]:"
PROMPT_ENTER_DB_TO_DELETE="Entrez le nom de la base de données à supprimer:"
MSG_DB_DELETED="Base de données '%s' supprimée."
MSG_WEBSITE_DELETED="Le site web '%s' a été complètement supprimé."
MSG_SITE_DISABLED="Le site '%s' a été désactivé."
MSG_SITE_ENABLED="Le site '%s' a été activé."
MENU_WEBSITE_OPTION_1="1. Supprimer un Site Web"
MENU_WEBSITE_OPTION_2="2. Désactiver un Site Web"
MENU_WEBSITE_OPTION_3="3. Activer un Site Web"
MENU_WEBSITE_OPTION_4="4. Retour au Menu de Gestion"

# --- SFTP User Management ---
MENU_SFTP_MGMT="--- Gestion des Utilisateurs SFTP ---"
MSG_JAILED_SFTP_USERS="--- Utilisateurs SFTP Emprisonnés ---"
MSG_NO_SFTP_USERS="Aucun utilisateur SFTP configuré dans /etc/ssh/sshd_config."
PROMPT_USERNAME_TO_MODIFY="Entrez le nom d'utilisateur à modifier:"
MSG_ERROR_USERNAME_EMPTY="Le nom d'utilisateur ne peut pas être vide."
MSG_ERROR_USER_NOT_SFTP="L'utilisateur '%s' n'est pas un utilisateur SFTP configuré."
PROMPT_NEW_PASSWORD="Entrez le nouveau mot de passe pour %s:"
MSG_PASSWORD_CHANGED="Le mot de passe pour '%s' a été modifié."
PROMPT_USERNAME_TO_DELETE="Entrez le nom d'utilisateur à supprimer:"
MSG_WARN_PERMANENT_DELETE_USER="Ceci supprimera définitivement l'utilisateur '%s' et sa configuration SFTP."
PROMPT_CONFIRM_DELETE_USER="Pour confirmer, veuillez taper le nom d'utilisateur '%s':"
MSG_USER_DELETED="Utilisateur système '%s' supprimé."
MSG_USER_NOT_FOUND_SKIPPING="Utilisateur système '%s' introuvable, suppression ignorée."
MSG_INFO_REMOVING_SFTP_CONF="Suppression de la configuration SFTP pour '%s'..."
MSG_SUCCESS_SFTP_CONF_REMOVED="Configuration SFTP pour '%s' supprimée."
MSG_ERROR_REMOVING_SFTP_CONF="Échec de la suppression de la configuration SFTP avec augtool."
MSG_SFTP_USER_DELETED="Utilisateur SFTP '%s' supprimé."
MENU_SFTP_OPTION_1="1. Changer le Mot de Passe d'un Utilisateur"
MENU_SFTP_OPTION_2="2. Supprimer un Utilisateur"
MENU_SFTP_OPTION_3="3. Retour au Menu de Gestion"

# --- Mail User Management ---
MENU_MAIL_MGMT="--- Gestion des Comptes de Messagerie ---"
MSG_EMAIL_ACCOUNTS="--- Comptes de Messagerie ---"
MSG_NO_MAIL_USERS="Aucun utilisateur de messagerie/système trouvé."
PROMPT_ADD_EMAIL_USER="Entrez le nouveau nom d'utilisateur de messagerie (ex: 'contact' pour 'contact@domaine.com'):"
PROMPT_PASSWORD_FOR_ACCOUNT="Entrez le mot de passe pour ce compte:"
MSG_SUCCESS_EMAIL_CREATED="Compte de messagerie '%s' créé. L'utilisateur peut maintenant se connecter via IMAP."
PROMPT_USERNAME_TO_DELETE_EMAIL="Entrez le nom d'utilisateur du compte à supprimer:"
MSG_ERROR_USER_NOT_EXIST="L'utilisateur '%s' n'existe pas."
MSG_WARN_PERMANENT_DELETE_EMAIL="Ceci supprimera définitivement l'utilisateur '%s' et tous ses e-mails."
PROMPT_CONFIRM_DELETE_EMAIL="Pour confirmer, veuillez taper le nom d'utilisateur '%s':"
MSG_EMAIL_DELETED="Le compte de messagerie '%s' et toutes les données associées ont été supprimés."
MENU_MAIL_OPTION_1="1. Ajouter un Compte de Messagerie"
MENU_MAIL_OPTION_2="2. Supprimer un Compte de Messagerie"
MENU_MAIL_OPTION_3="3. Lister les Comptes de Messagerie"
MENU_MAIL_OPTION_4="4. Retour au Menu de Gestion"

# --- General Management ---
MENU_MGMT_TITLE="Gérer les Services Existants"
MENU_LIST_WEBSITES_HEADER="--- Sites Web Disponibles ---"
MENU_LIST_WEBSITES_ENABLED="(Activé)"
MENU_LIST_WEBSITES_DISABLED="(Désactivé)"
MENU_MGMT_OPTION_1="1. Gérer les Sites Web"
MENU_MGMT_OPTION_2="2. Gérer les Utilisateurs SFTP"
MENU_MGMT_OPTION_3="3. Gérer les Comptes de Messagerie"
MENU_MGMT_OPTION_4="4. Retour au Menu Principal"
MSG_RETURN_TO_MAIN_MENU="Retour au menu principal."

# --- Validation ---
MSG_ERROR_INVALID_INPUT="Entrée invalide."
MSG_ERROR_INVALID_DOMAIN="Format de nom de domaine invalide."
MSG_ERROR_INVALID_EMAIL="Format d'adresse e-mail invalide."
MSG_ERROR_INVALID_USERNAME="Nom d'utilisateur invalide. Doit commencer par une lettre et ne contenir que des lettres, chiffres, tirets ou underscores."
MSG_ERROR_INVALID_PATH="Chemin invalide. Doit être un chemin absolu (commencer par /)."
MSG_ERROR_INVALID_DB_NAME="Nom de base de données invalide. Seuls les lettres, chiffres et underscores sont autorisés."
MSG_ERROR_CANNOT_BE_EMPTY="Ce champ ne peut pas être vide."
MSG_WARN_SFTP_CONF_EXISTS="La configuration SFTP pour l'utilisateur '%s' existe déjà. Configuration SSH ignorée."
